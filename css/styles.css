/* ========================================
   KAPOW! Card Game â€” Comic Pop Card Table
   ======================================== */

/* ---- Design Tokens ---- */
:root {
  --card-width: 100px;
  --card-height: 140px;
  --card-gap: 10px;
  --card-radius: 10px;

  /* Card type colors */
  --color-fixed: #1a5490;
  --color-power: #d4920a;
  --color-kapow: #d63031;
  --color-card-back: #1a4f8a;

  /* Table & chrome */
  --color-bg: #1a6b2a;
  --color-bg-dark: #0c3a14;
  --color-bg-felt: #17572a;
  --color-text: #f0f0f0;
  --color-accent: #fbbf24;
  --color-accent-glow: rgba(251, 191, 36, 0.5);
  --color-danger: #ef4444;
  --color-success: #22c55e;

  /* Typography */
  --font-display: 'Bangers', cursive;
  --font-body: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;

  /* Shadows */
  --shadow-card: 0 2px 4px rgba(0,0,0,0.2), 0 1px 2px rgba(0,0,0,0.15);
  --shadow-card-hover: 0 8px 20px rgba(0,0,0,0.3), 0 2px 6px rgba(0,0,0,0.2);
  --shadow-card-selected: 0 0 0 2px var(--color-accent), 0 0 8px var(--color-accent-glow);
  --shadow-ui: 0 2px 8px rgba(0,0,0,0.3);
}

/* ---- Reset ---- */
*, *::before, *::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* ---- Body / Table ---- */

body {
  font-family: var(--font-body);
  font-weight: 500;
  /* Solid bg color bleeds under Dynamic Island + Safari footer via viewport-fit=cover */
  background-color: var(--color-bg-dark);
  color: var(--color-text);
  display: flex;
  justify-content: center;
  align-items: flex-start;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Felt texture as a fixed background layer that bleeds past viewport edges */
body::before {
  content: '';
  position: fixed;
  inset: -50px;
  background:
    url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E"),
    radial-gradient(ellipse at 50% 40%, var(--color-bg) 0%, var(--color-bg-dark) 100%);
  z-index: -1;
  pointer-events: none;
}

/* ---- Layout Shell ---- */
#page-layout {
  display: flex;
  gap: 20px;
  width: 100%;
  max-width: 1400px;
  padding: 10px 20px;
  justify-content: center;
  align-items: flex-start;
}

#game-container {
  flex: 1;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* ---- Play Area: piles flanking hands ---- */
#play-area {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20px;
  width: 100%;
}

#hands-column {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
}

/* ---- Center Strip (message + action buttons between hands) ---- */
#center-strip {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 6px 0;
  width: 100%;
  justify-content: center;
}

#center-strip #game-message {
  flex: 1;
  max-width: 500px;
}

#center-strip #action-controls {
  flex-shrink: 0;
}

/* ---- Sidebar ---- */
#sidebar {
  display: flex;
  flex-direction: column;
  align-items: center;
  align-self: flex-start;
  position: sticky;
  top: 10px;
  padding-top: 24px;
  gap: 16px;
  min-width: 200px;
}

/* ---- Hand Grid ---- */
.hand-grid {
  display: flex;
  gap: 14px;
  justify-content: center;
  flex-wrap: nowrap;
}

.triad-column {
  display: flex;
  flex-direction: column;
  gap: 6px;
  align-items: center;
  padding: 8px 6px;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.04);
  border: 1px solid rgba(255, 255, 255, 0.06);
  transition: background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
}

.triad-column.complete {
  background: rgba(34, 197, 94, 0.15);
  border-color: var(--color-success);
  box-shadow: 0 0 12px rgba(34, 197, 94, 0.2);
}

.triad-column.discarded-triad {
  opacity: 0.25;
  background: rgba(255, 255, 255, 0.02);
  border-color: transparent;
}

.triad-column.discarded-triad .empty-slot {
  border: 1px dashed rgba(255, 255, 255, 0.12);
  border-radius: var(--card-radius);
}

.triad-label {
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  opacity: 0.5;
  margin-bottom: 2px;
}

/* ---- Cards ---- */
.card {
  width: var(--card-width);
  height: var(--card-height);
  border-radius: var(--card-radius);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease;
  position: relative;
  user-select: none;
  box-shadow: var(--shadow-card);
}

.card:hover {
  transform: translateY(-5px) scale(1.02);
  box-shadow: var(--shadow-card-hover);
}

/* Card Back â€” rich blue with subtle pattern */
.card-back {
  background: linear-gradient(145deg, #2563eb, #1d4ed8);
  border: 2.5px solid #1e40af;
}

.card-back-inner {
  border: none;
  padding: 0;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  flex: 1;
}

.card-back-text {
  color: white;
  font-family: var(--font-display);
  font-size: clamp(10px, 2.2svh, 15px);
  letter-spacing: clamp(0.5px, 0.3svh, 2px);
  text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

/* Fixed Cards â€” clean white with strong number */
.card-fixed {
  background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
  border: 2.5px solid #d1d5db;
  color: var(--color-fixed);
}

.card-value-top {
  position: absolute;
  top: 6px;
  left: 8px;
  font-size: 13px;
  font-weight: 700;
}

.card-value-center {
  font-size: 38px;
  font-weight: 700;
  line-height: 1;
  font-family: var(--font-body);
  letter-spacing: -1px;
}

.card-type-label {
  font-size: 9px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: #9ca3af;
  position: absolute;
  bottom: 6px;
  right: 7px;
}

.card-value-bottom {
  position: absolute;
  bottom: 6px;
  left: 8px;
  font-size: 13px;
  font-weight: 700;
}

/* Power Cards â€” golden premium feel */
.card-power {
  background: linear-gradient(145deg, #fbbf24, #f59e0b);
  border: 2.5px solid #d97706;
  color: #1c1917;
}

.card-power .card-type-label {
  color: #92400e;
  font-weight: 700;
  font-style: normal;
  position: static;
  margin-bottom: 2px;
}

.card-power-face-value {
  font-size: 34px;
  font-weight: 700;
  font-family: var(--font-body);
  letter-spacing: -1px;
}

.card-power-modifiers {
  display: flex;
  justify-content: space-between;
  width: 80%;
  font-size: 16px;
  font-weight: 700;
}

.modifier-positive {
  color: #166534;
}

.modifier-negative {
  color: #dc2626;
}

/* KAPOW! Cards â€” dramatic starburst */
.card-kapow {
  background: radial-gradient(circle at 40% 40%, #ffffff 20%, #fef3c7 60%, #fde68a 100%);
  border: 3px solid var(--color-danger);
  overflow: hidden;
  position: relative;
}

.card-kapow::before {
  content: '';
  position: absolute;
  width: 200%;
  height: 200%;
  top: -50%;
  left: -50%;
  background: conic-gradient(
    from 0deg,
    #ef4444 0deg 18deg,
    transparent 18deg 36deg,
    #f97316 36deg 54deg,
    transparent 54deg 72deg,
    #eab308 72deg 90deg,
    transparent 90deg 108deg,
    #22c55e 108deg 126deg,
    transparent 126deg 144deg,
    #3b82f6 144deg 162deg,
    transparent 162deg 180deg,
    #8b5cf6 180deg 198deg,
    transparent 198deg 216deg,
    #ef4444 216deg 234deg,
    transparent 234deg 252deg,
    #f97316 252deg 270deg,
    transparent 270deg 288deg,
    #eab308 288deg 306deg,
    transparent 306deg 324deg,
    #22c55e 324deg 342deg,
    transparent 342deg 360deg
  );
  opacity: 0.2;
  z-index: 0;
  animation: kapow-spin 30s linear infinite;
}

@keyframes kapow-spin {
  to { transform: rotate(360deg); }
}

.kapow-text {
  font-family: var(--font-display);
  font-size: clamp(12px, 2.8svh, 19px);
  color: var(--color-danger);
  z-index: 1;
  letter-spacing: clamp(1px, 0.5svh, 3px);
  text-shadow: 0 1px 0 rgba(0,0,0,0.1);
}

.kapow-value {
  font-size: 11px;
  font-weight: 700;
  color: #b91c1c;
  z-index: 1;
  margin-top: 4px;
}

/* Card Frozen State */
.card.frozen {
  opacity: 0.85;
}

.card.frozen::after {
  content: 'ðŸ”’';
  position: absolute;
  top: 4px;
  right: 4px;
  font-size: 12px;
  z-index: 2;
}

/* Card Selected */
.card.selected {
  border-color: var(--color-accent) !important;
  box-shadow: var(--shadow-card-selected);
  transform: translateY(-6px) scale(1.03);
}

/* Card Clickable Highlight */
.card.clickable {
  border-color: var(--color-accent) !important;
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { box-shadow: var(--shadow-card); }
  50% { box-shadow: var(--shadow-card-selected); }
}

/* Empty Pile */
.empty-pile {
  background: rgba(255, 255, 255, 0.06);
  border: 2px dashed rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.3);
  font-size: 13px;
  font-weight: 600;
}

/* Powerset Stack */
.position-slot {
  position: relative;
  min-height: var(--card-height);
  min-width: var(--card-width);
}

.pos-label {
  display: none;
  white-space: nowrap;
}

.top-row-label {
  display: none;
}

.powerset-info {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 4px;
  background: rgba(212, 146, 10, 0.2);
  border: 1px solid rgba(212, 146, 10, 0.5);
  border-radius: 6px;
  padding: 2px 8px;
  margin-top: 3px;
  font-size: 12px;
  font-weight: 700;
}

.powerset-modifier {
  color: var(--color-power);
}

.powerset-effective {
  color: #fff;
}

.position-slot .card.stacked {
  position: absolute;
  top: 0;
  left: 0;
}

.position-slot .card.stacked:nth-child(2) {
  top: -8px;
  left: 4px;
  z-index: -1;
  opacity: 0.7;
  transform: scale(0.95);
}

.position-slot .card.stacked:nth-child(3) {
  top: -16px;
  left: 8px;
  z-index: -2;
  opacity: 0.5;
  transform: scale(0.9);
}

/* ---- Piles ---- */
.pile {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  flex-shrink: 0;
  /* Fixed width prevents layout shift when discard-target class toggles */
  width: var(--card-width);
}

.drawn-highlight .card {
  box-shadow: 0 0 0 3px var(--color-accent), 0 0 12px var(--color-accent-glow);
  animation: pulse 1.2s infinite;
}

/* AI action highlights */
.ai-draw-highlight .card {
  box-shadow: 0 0 0 3px #3b82f6, 0 0 12px rgba(59, 130, 246, 0.4);
  animation: ai-pulse 1s infinite;
}

.ai-place-highlight .card {
  outline: 3px solid var(--color-success);
  outline-offset: 2px;
  animation: ai-pulse 1s infinite;
}

.ai-reveal-highlight .card {
  outline: 3px solid #f97316;
  outline-offset: 2px;
  animation: ai-pulse 1s infinite;
}

@keyframes ai-pulse {
  0%, 100% { box-shadow: 0 0 6px rgba(59, 130, 246, 0.4); }
  50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
}

.kapow-selected-highlight .card {
  outline: 3px solid #f97316;
  outline-offset: 2px;
  animation: kapow-highlight-pulse 0.8s infinite;
}

@keyframes kapow-highlight-pulse {
  0%, 100% { box-shadow: 0 0 8px rgba(249, 115, 22, 0.5); }
  50% { box-shadow: 0 0 22px rgba(249, 115, 22, 0.9); }
}

.pile.discard-target .card,
.pile.discard-target .empty-pile {
  animation: pulse 1.2s infinite;
}

.pile.discard-target .pile-label::after {
  content: '';
}

.pile-label {
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  opacity: 0.6;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}

.pile-count {
  font-size: 10px;
  opacity: 0.4;
  font-weight: 500;
}

/* ---- Game Message ---- */
#game-message {
  background: rgba(0, 0, 0, 0.45);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  padding: 10px 18px;
  border-radius: 10px;
  font-size: 15px;
  font-weight: 600;
  text-align: center;
  height: 50px;
  line-height: 1.4;
  overflow-y: auto;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.08);
}

#game-message.swap-phase-message {
  background: rgba(234, 179, 8, 0.15);
  border: 2px solid rgba(234, 179, 8, 0.5);
  color: var(--color-accent);
}

#game-message.tutorial-message {
  background: rgba(59, 130, 246, 0.15);
  border: 1px solid rgba(59, 130, 246, 0.4);
  color: #93c5fd;
}

/* ---- Section Headers ---- */
#ai-area h2,
#player-area h2 {
  text-align: center;
  margin-bottom: 4px;
  font-size: 13px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  opacity: 0.7;
}

/* ---- Action Controls ---- */
#action-controls {
  display: flex;
  gap: 8px;
  justify-content: center;
}

.action-btn {
  padding: 8px 18px;
  font-family: var(--font-body);
  font-size: 13px;
  font-weight: 700;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background: #2563eb;
  color: white;
  transition: all 0.15s ease;
  letter-spacing: 0.3px;
}

.action-btn:hover:not(:disabled) {
  background: #1d4ed8;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
}

.action-btn:active:not(:disabled) {
  transform: translateY(0);
}

.action-btn:disabled {
  opacity: 0.35;
  cursor: not-allowed;
}

.action-btn.kapow-btn {
  background: #7c3aed;
}

.action-btn.kapow-btn:hover:not(:disabled) {
  background: #6d28d9;
  box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
}

/* End Turn button glow */
.action-btn.end-turn-glow {
  background: #ea580c;
  color: white;
  font-size: 15px;
  padding: 10px 24px;
  animation: end-turn-pulse 1.2s infinite;
  border: 2px solid #f97316;
}

.action-btn.end-turn-glow:hover {
  background: #c2410c;
}

@keyframes end-turn-pulse {
  0%, 100% { box-shadow: 0 0 8px rgba(249, 115, 22, 0.4); }
  50% { box-shadow: 0 0 24px rgba(249, 115, 22, 0.8), 0 0 48px rgba(249, 115, 22, 0.3); }
}

.action-btn.release-card-glow {
  background: #2563eb;
  color: white;
  font-size: 15px;
  padding: 10px 24px;
  animation: release-card-pulse 1.2s infinite;
  border: 2px solid #3b82f6;
}

.action-btn.release-card-glow:hover {
  background: #1d4ed8;
}

@keyframes release-card-pulse {
  0%, 100% { box-shadow: 0 0 8px rgba(59, 130, 246, 0.4); }
  50% { box-shadow: 0 0 24px rgba(59, 130, 246, 0.8), 0 0 48px rgba(59, 130, 246, 0.3); }
}

/* Hint button */
.hint-btn {
  background: transparent;
  color: var(--color-accent);
  border: 1px solid rgba(251, 191, 36, 0.3) !important;
  font-size: 11px;
  padding: 4px 10px;
}

.hint-btn:hover:not(:disabled) {
  background: rgba(251, 191, 36, 0.1);
  box-shadow: 0 2px 8px rgba(251, 191, 36, 0.15);
  border-color: rgba(251, 191, 36, 0.5) !important;
}

/* Hint message in game message area */
.hint-message {
  color: var(--color-accent);
  font-style: italic;
}

/* ---- Power Card Modal ---- */
#power-modal {
  position: fixed;
  inset: 0;
  background: transparent;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 150;
  pointer-events: none;
}

#power-modal .modal-content {
  pointer-events: auto;
}

.modal-content {
  background: linear-gradient(145deg, #0f2a1a, #1a3f2a);
  padding: 32px;
  border-radius: 16px;
  text-align: center;
  max-width: 420px;
  width: 90%;
  border: 2px solid var(--color-accent);
  box-shadow: 0 24px 48px rgba(0,0,0,0.5);
}

.modal-title {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 20px;
  line-height: 1.5;
}

.modal-buttons {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.modal-btn {
  padding: 12px 20px;
  font-family: var(--font-body);
  font-size: 15px;
  font-weight: 700;
  border: 2px solid transparent;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s ease;
  color: white;
}

.modal-btn.primary {
  background: #2563eb;
  border-color: #2563eb;
}

.modal-btn.primary:hover {
  background: #1d4ed8;
  transform: translateY(-1px);
}

.modal-btn.secondary {
  background: #7c3aed;
  border-color: #7c3aed;
}

.modal-btn.secondary:hover {
  background: #6d28d9;
  transform: translateY(-1px);
}

.modal-btn.accent {
  background: #d97706;
  color: #fff;
  border-color: #d97706;
}

.modal-btn.accent:hover {
  background: #b45309;
  transform: translateY(-1px);
}

/* ---- Overlays (Game Over / Round End) ---- */
#game-over-screen,
#round-end-screen {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 100;
}

.game-over-content,
.round-end-content {
  background: linear-gradient(145deg, #0f2a1a, #1a3f2a);
  padding: 40px;
  border-radius: 20px;
  text-align: center;
  max-width: 480px;
  width: 90%;
  border: 2px solid var(--color-accent);
  box-shadow: 0 24px 64px rgba(0,0,0,0.5);
}

.game-over-content h1 {
  font-family: var(--font-display);
  font-size: 42px;
  margin-bottom: 20px;
  color: var(--color-accent);
  letter-spacing: 3px;
}

.round-end-content h2 {
  font-family: var(--font-display);
  font-size: 28px;
  margin-bottom: 16px;
  color: var(--color-accent);
  letter-spacing: 2px;
}

#final-scores,
#round-scores {
  margin: 16px 0;
  font-size: 17px;
  line-height: 1.8;
}

/* ---- Scorecard Sidebar ---- */
#scorecard {
  width: 200px;
  min-width: 200px;
  background: rgba(0, 0, 0, 0.35);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-radius: 14px;
  padding: 20px;
  border: 1px solid rgba(255, 255, 255, 0.08);
}

#scorecard h3 {
  text-align: center;
  font-family: var(--font-display);
  font-size: 22px;
  margin-bottom: 14px;
  color: var(--color-accent);
  letter-spacing: 2px;
}

#scorecard-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 15px;
}

#scorecard-table th,
#scorecard-table td {
  padding: 5px 8px;
  text-align: center;
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

#scorecard-table thead th {
  font-size: 13px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--color-accent);
  border-bottom: 2px solid rgba(255, 255, 255, 0.15);
  padding-bottom: 8px;
}

#scorecard-table tbody td {
  color: rgba(255, 255, 255, 0.5);
  font-weight: 500;
}

#scorecard-table tbody tr.current-round {
  background: rgba(251, 191, 36, 0.1);
}

#scorecard-table tbody tr.current-round td {
  color: rgba(255, 255, 255, 0.8);
}

#scorecard-table tbody tr.completed-round td {
  color: rgba(255, 255, 255, 0.9);
  font-weight: 700;
}

#scorecard-table tfoot td {
  border-top: 2px solid rgba(255, 255, 255, 0.2);
  border-bottom: none;
  padding-top: 10px;
  font-size: 17px;
  color: var(--color-accent);
  font-weight: 700;
}

/* ---- Name Entry Screen ---- */
#name-screen {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  background:
    radial-gradient(ellipse at 50% 40%, var(--color-bg) 0%, var(--color-bg-dark) 100%);
  z-index: 200;
}

.name-screen-content {
  text-align: center;
  background: rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  padding: 48px 56px;
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 24px 64px rgba(0,0,0,0.3);
}

.name-screen-content h1 {
  font-family: var(--font-display);
  font-size: 64px;
  color: var(--color-accent);
  margin-bottom: 8px;
  letter-spacing: 6px;
  text-shadow: 2px 2px 0 rgba(0,0,0,0.3);
  line-height: 1;
}

.name-screen-content p {
  font-size: 16px;
  font-weight: 500;
  margin-bottom: 24px;
  opacity: 0.7;
}

#player-name-input {
  display: block;
  width: 260px;
  margin: 0 auto 20px;
  padding: 12px 16px;
  font-family: var(--font-body);
  font-size: 16px;
  font-weight: 600;
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.08);
  color: white;
  text-align: center;
  outline: none;
  transition: all 0.2s ease;
}

#player-name-input::placeholder {
  color: rgba(255, 255, 255, 0.3);
  font-weight: 400;
}

#player-name-input:focus {
  border-color: var(--color-accent);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 0 3px var(--color-accent-glow);
}

/* ---- Card Animations ---- */

/* Card flip-in: used when a card is revealed */
.card-flip-in {
  animation: cardFlipIn 0.35s ease-out both;
}

@keyframes cardFlipIn {
  0% {
    transform: rotateY(90deg) scale(0.9);
    opacity: 0.5;
  }
  100% {
    transform: rotateY(0deg) scale(1);
    opacity: 1;
  }
}

/* Perspective container for 3D flip */
.position-slot {
  perspective: 600px;
}

/* Card slide-in: used when a card is placed */
.card-slide-in {
  animation: cardSlideIn 0.25s ease-out both;
}

@keyframes cardSlideIn {
  0% {
    transform: translateY(-20px);
    opacity: 0.6;
  }
  100% {
    transform: translateY(0);
    opacity: 1;
  }
}

/* KAPOW placement glow burst */
.card-kapow-placed {
  animation: kapowPlacedGlow 0.5s ease-out both;
}

@keyframes kapowPlacedGlow {
  0% {
    box-shadow: 0 0 0 0 rgba(214, 48, 49, 0.8);
    transform: scale(1.08);
  }
  50% {
    box-shadow: 0 0 24px 8px rgba(214, 48, 49, 0.4);
  }
  100% {
    box-shadow: var(--shadow-card);
    transform: scale(1);
  }
}

/* Screen shake on triad completion */
.screen-shake {
  animation: screenShake 0.3s ease-out;
}

@keyframes screenShake {
  0%, 100% { transform: translate(0, 0); }
  15% { transform: translate(-3px, 1px); }
  30% { transform: translate(3px, -1px); }
  45% { transform: translate(-2px, 2px); }
  60% { transform: translate(2px, -1px); }
  75% { transform: translate(-1px, 1px); }
}

/* ---- Mute Button ---- */
.mute-btn {
  background: none;
  border: none;
  font-size: 14px;
  cursor: pointer;
  padding: 2px 4px;
  line-height: 1;
  opacity: 0.5;
  transition: opacity 0.15s ease;
}

.mute-btn:hover {
  opacity: 1;
}

/* ---- Utility ---- */
.hidden {
  display: none !important;
}

/* ---- Mobile Score Bar (hidden on desktop) ---- */
#mobile-score-bar {
  display: none;
}

/* ---- Mobile Banter (hidden on desktop) ---- */
#mobile-banter {
  display: none;
}

/* ============================================
   DESKTOP EXPLICIT LAYOUT LOCK
   Forces horizontal flex layout regardless of
   any cascade issues. Mobile overrides below.
   ============================================ */
@media (min-width: 769px) {
  /* Cards scale to viewport height so both hands + center strip fit.
     Budget: headers Ã—2 (48px), center strip (120px), gaps (40px), padding (20px) = ~230px.
     Clamped: min 68px, max 120px. */
  :root {
    --card-height: clamp(68px, calc((100vh - 230px) / 6), 120px);
    --card-width: calc(var(--card-height) * 0.714);
  }

  #page-layout {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    gap: 20px;
  }

  #game-container {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Piles sit directly next to the hands â€” gap:12px keeps them tucked in tight.
     justify-content:center packs everything without stretching to edges. */
  #play-area {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    width: auto;
    max-width: 100%;
  }

  #hands-column {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
    padding-bottom: 32px;
  }

  #ai-area,
  #player-area {
    flex-shrink: 0;
  }

  #sidebar {
    display: flex;
    flex-direction: column;
    min-width: 200px;
  }

  #mobile-score-bar,
  #mobile-banter {
    display: none !important;
  }

  /* Center strip: fixed height reserves space so layout doesn't bounce.
     align-self:stretch locks width to hands-column. */
  #center-strip {
    align-self: stretch;
    flex-shrink: 0;
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
    min-height: 100px;
  }

  #center-strip #game-message {
    flex: 0 0 100%;
    max-width: 100%;
    text-align: center;
    white-space: normal;
    height: 50px;
    min-height: 50px;
  }

  #center-strip #action-controls {
    flex: 0 0 100%;
    display: flex;
    justify-content: center;
    gap: 10px;
    min-height: 32px;
  }

  #center-strip #btn-understand-move {
    flex: 0 0 100%;
    max-width: 200px;
    margin: 0 auto;
    text-align: center;
  }
}

/* Mid-range desktop: tighten gaps so 4 triads fit side by side comfortably.
   Card sizes are handled dynamically by the formula above. */
@media (min-width: 769px) and (max-width: 1100px) {
  #play-area {
    gap: 8px;
  }

  .hand-grid {
    gap: 6px;
  }

  .triad-column {
    gap: 5px;
    padding: 5px 4px;
  }
}

/* ---- Sidebar Toggle (hidden on desktop) ---- */
#sidebar-toggle {
  display: none;
}

/* ============================================
   RESPONSIVE â€” MOBILE
   ============================================ */
@media (max-width: 768px) {
  :root {
    /* Both hands + piles use identical card sizes. 3-row layout:
       AI(3 rows) + center(1 pile row) + player(3 rows) = 7 card rows.
       Budget: svh - 25(score) - 50(gaps/labels) = svh - 75
       Per card row: (svh - 75) / 7. At svh=660: ~83px.
       Width follows ~4:5 ratio for digital cards. */
    --card-width: min(66px, 9.5svh);
    --card-height: min(83px, 12svh);
  }

  html, body {
    height: 100%;
    overflow: hidden;
  }

  body {
    -webkit-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
  }

  #page-layout {
    width: 100%;
    height: 100dvh;
    flex-direction: column;
    align-items: stretch;
    padding: 4px 4px;
    padding-top: max(4px, env(safe-area-inset-top, 4px));
    padding-bottom: max(4px, env(safe-area-inset-bottom, 4px));
    gap: 0;
    overflow: hidden;
  }

  #game-container {
    flex: 1;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 0;
  }

  /* Hide sidebar by default on mobile */
  #sidebar {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 180;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    padding: 20px;
    justify-content: center;
    align-items: center;
    min-width: unset;
  }

  #sidebar.mobile-visible {
    display: flex;
  }

  #sidebar #scorecard {
    width: 280px;
    max-height: 80vh;
    overflow-y: auto;
  }

  #sidebar .scorecard-actions {
    width: 100%;
  }

  /* Unified mobile top bar â€” all controls in one row */
  #mobile-score-bar {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 0;
    height: 32px;
    font-weight: 700;
    background: rgba(0, 0, 0, 0.45);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    margin-bottom: 2px;
    flex-shrink: 0;
  }

  /* Top bar button style (? and Score) â€” match center strip bg */
  .top-bar-btn {
    height: 32px;
    background: rgba(0, 0, 0, 0.45);
    border: 1px solid rgba(255, 255, 255, 0.08);
    color: rgba(255, 255, 255, 0.7);
    font-family: var(--font-body);
    font-size: 12px;
    font-weight: 700;
    cursor: pointer;
    padding: 0 12px;
    flex-shrink: 0;
  }

  #mobile-help-btn {
    border-radius: 10px 0 0 10px;
    width: 36px;
    padding: 0;
    font-size: 15px;
    border-right: none;
  }

  #sidebar-toggle {
    display: block;
    border-radius: 0 10px 10px 0;
    color: var(--color-accent);
    letter-spacing: 0.5px;
    margin-left: auto;
    border-left: none;
  }

  .top-bar-btn:active {
    background: rgba(255, 255, 255, 0.15);
  }

  /* Hide desktop help toggle on mobile */
  #help-toggle {
    display: none !important;
  }

  /* Mobile banter â€” above AI hand */
  #mobile-banter {
    display: none;
    text-align: center;
    font-size: 12px;
    font-style: italic;
    font-weight: 500;
    color: var(--color-accent);
    padding: 2px 8px;
    opacity: 0.8;
    line-height: 1.3;
    flex-shrink: 0;
    animation: banterFadeIn 0.4s ease-out;
  }

  #mobile-banter.visible {
    display: block;
  }

  #mobile-score-bar .score-label {
    color: rgba(255, 255, 255, 0.6);
    font-size: 11px;
    font-weight: 600;
  }

  #mobile-score-bar .score-value {
    color: var(--color-accent);
    font-size: 15px;
    font-weight: 700;
  }

  #mobile-score-bar .round-info {
    color: rgba(255, 255, 255, 0.5);
    font-size: 11px;
    font-weight: 600;
  }

  /* CSS grid layout for mobile â€” 3 rows: AI / piles+controls / player
     Center row uses 3 columns: draw | controls | discard
     This fills horizontal space and keeps piles at normal card size */
  #play-area {
    display: grid;
    grid-template-columns: auto 1fr auto;
    grid-template-rows: auto auto auto;
    grid-template-areas:
      "ai      ai      ai"
      "draw    msg     discard"
      "player  player  player";
    gap: 2px;
    padding: 0 12px;
    justify-items: center;
    align-items: center;
    align-content: center;
    flex: 1;
    min-height: 0;
    overflow: hidden;
  }

  #hands-column {
    display: contents;
  }

  #ai-area { grid-area: ai; }
  #left-column { grid-area: draw; justify-self: center; align-self: stretch; display: flex; flex-direction: column; align-items: center; justify-content: center; }
  #discard-pile { grid-area: discard; justify-self: center; align-self: stretch; display: flex; flex-direction: column; align-items: center; justify-content: center; }
  #center-strip { grid-area: msg; align-self: stretch; justify-content: center; }
  #player-area { grid-area: player; }

  /* AI hand â€” same card size as player, just hide labels to save space */
  #ai-area h2 {
    font-size: 9px;
    margin-bottom: 1px;
  }

  #ai-area .triad-label {
    display: none;
  }

  /* Draw pile column â€” just the pile, no extra elements */
  #left-column {
    flex-direction: column;
    gap: 2px;
    align-items: center;
  }

  /* Understand AI Move â€” compact in center strip on mobile */
  .understand-btn {
    font-size: 9px;
    padding: 3px 8px;
    line-height: 1.2;
  }

  /* Center strip â€” message + buttons stacked vertically between piles.
     Height matches the pile columns (1 card + label) so the middle
     grid row stays consistent. No more bouncing. */
  #center-strip {
    flex-direction: column;
    gap: 3px;
    padding: 0;
    width: 100%;
    min-height: var(--card-height);
    justify-content: center;
    align-items: center;
  }

  #center-strip #game-message {
    font-size: 11px;
    height: 32px;
    min-height: 32px;
    padding: 4px 8px;
    text-align: center;
    word-break: break-word;
    line-height: 1.3;
    max-width: 100%;
    overflow: hidden;
  }

  /* Cards and grid â€” breathing room between triads */
  .hand-grid {
    gap: 6px;
    padding: 0 4px;
  }

  .triad-column {
    padding: 3px;
    gap: 3px;
  }

  .triad-label {
    font-size: 8px;
    margin-bottom: 0;
  }

  /* Pile cards â€” same size as hand cards for consistency */
  .pile .card,
  .pile .empty-pile {
    width: var(--card-width);
    height: var(--card-height);
  }

  .pile {
    gap: 0;
  }

  .pile-count {
    display: none;
  }

  /* Turn counter hidden on mobile â€” redundant with score bar round info */
  #turn-counter {
    display: none;
  }

  /* Section headers â€” hide to save vertical space */
  #ai-area h2,
  #player-area h2 {
    display: none;
  }

  /* Hide all triad labels on mobile */
  .triad-label {
    display: none;
  }

  /* Show "TOP" row indicator on first triad */
  .top-row-label {
    display: block;
    position: absolute;
    left: -16px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 7px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: rgba(255, 255, 255, 0.25);
    writing-mode: vertical-lr;
    text-orientation: mixed;
  }

  .position-slot.top-row {
    position: relative;
  }

  /* Action buttons */
  .action-btn {
    padding: 4px 10px;
    font-size: 11px;
  }

  /* Pile labels */
  .pile-label {
    font-size: 9px;
    margin-top: 0;
  }

  .pile-count {
    font-size: 8px;
  }

  /* Position labels already hidden globally */

  /* AI commentary */
  #ai-commentary {
    width: 100%;
    min-width: unset;
    font-size: 16px;
    padding: 8px 12px;
  }

  /* Modals */
  .game-over-content,
  .round-end-content {
    padding: 24px 16px;
    width: 95%;
  }

  .explain-modal-content {
    width: 95%;
    padding: 20px 16px;
  }
}

@media (max-width: 480px) {
  /* Tighter sizing for narrow phones. Same 7-row budget. */
  :root {
    --card-width: min(60px, 8.8svh);
    --card-height: min(76px, 11svh);
  }

  .hand-grid {
    gap: 3px;
  }

  .triad-column {
    padding: 2px;
    gap: 2px;
  }

  .card-value-center {
    font-size: clamp(16px, 3svh, 24px);
  }

  .card-value-top {
    font-size: 9px;
    top: 2px;
    left: 3px;
  }

  .card-value-bottom {
    font-size: 9px;
    bottom: 2px;
    left: 3px;
  }

  .card-type-label {
    font-size: 7px;
    bottom: 2px;
    right: 3px;
  }

  .card-back-text {
    font-size: clamp(8px, 1.5svh, 10px);
    letter-spacing: 0.5px;
  }

  .card-back-inner {
    padding: 3px 4px;
  }

  .kapow-text {
    font-size: clamp(10px, 2svh, 13px);
    letter-spacing: 0.5px;
  }

  .kapow-value {
    font-size: 8px;
  }

  .card-power-face-value {
    font-size: clamp(16px, 3svh, 24px);
  }

  .card-power-modifiers {
    font-size: clamp(9px, 1.8svh, 12px);
  }

  .card-power .card-type-label {
    font-size: 7px;
  }

  .powerset-info {
    font-size: 9px;
    padding: 1px 3px;
  }

  #mobile-score-bar {
    gap: 6px;
    height: 28px;
  }

  .top-bar-btn {
    height: 28px;
    font-size: 11px;
    padding: 0 8px;
  }

  #mobile-help-btn {
    width: 30px;
  }

}

/* ---- Left Column (draw pile) ---- */
#left-column {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  flex-shrink: 0;
}

/* ---- Understand AI's Move Button ---- */
.understand-btn {
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.15);
  font-size: 11px;
  padding: 6px 10px;
  line-height: 1.3;
  text-align: center;
  width: auto;
  max-width: 200px;
  transition: all 0.2s ease;
}

.understand-btn:not(:disabled) {
  background: #2563eb;
  border-color: #3b82f6;
  animation: understand-ready 2s infinite;
}

.understand-btn:hover:not(:disabled) {
  background: #1d4ed8;
}

@keyframes understand-ready {
  0%, 100% { box-shadow: 0 0 4px rgba(59, 130, 246, 0.3); }
  50% { box-shadow: 0 0 14px rgba(59, 130, 246, 0.6); }
}

/* ---- AI Explanation Modal ---- */
#explain-modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.65);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 160;
}

.explain-modal-content {
  background: linear-gradient(145deg, #0f1f2e, #1a3045);
  padding: 28px 32px;
  border-radius: 16px;
  max-width: 480px;
  width: 90%;
  border: 2px solid #3b82f6;
  max-height: 80vh;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  box-shadow: 0 24px 48px rgba(0,0,0,0.5);
}

.explain-modal-content h3 {
  font-family: var(--font-display);
  font-size: 22px;
  color: #60a5fa;
  margin-bottom: 16px;
  text-align: center;
  letter-spacing: 1px;
}

#explain-text {
  font-size: 14px;
  line-height: 1.7;
  color: rgba(255, 255, 255, 0.85);
  margin-bottom: 20px;
}

#explain-text p {
  margin-bottom: 10px;
}

#explain-text .explain-step {
  padding: 6px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
}

#explain-text .explain-step:last-child {
  border-bottom: none;
}

#explain-text .explain-label {
  font-weight: 700;
  color: #60a5fa;
}

/* Lightbulb takeaway tip */
.explain-takeaway {
  margin-top: 16px;
  padding: 12px 14px;
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.12), rgba(251, 191, 36, 0.06));
  border: 1px solid rgba(251, 191, 36, 0.25);
  border-radius: 10px;
  display: flex;
  gap: 10px;
  align-items: flex-start;
  line-height: 1.5;
}

.explain-takeaway-icon {
  font-size: 18px;
  flex-shrink: 0;
  line-height: 1.4;
}

.explain-takeaway-text {
  color: rgba(255, 255, 255, 0.9);
  font-size: 13px;
  font-weight: 500;
}

.explain-modal-content .action-btn {
  display: block;
  margin: 0 auto;
  min-width: 100px;
}

/* ---- Turn Counter ---- */
#turn-counter {
  font-size: 12px;
  font-weight: 700;
  color: var(--color-accent);
  text-align: center;
  padding: 4px 10px;
  background: rgba(0, 0, 0, 0.35);
  border-radius: 8px;
  margin-bottom: 6px;
  white-space: nowrap;
  letter-spacing: 0.3px;
}

/* ---- AI Commentary ---- */
#ai-commentary {
  width: 200px;
  min-width: 200px;
  background: rgba(0, 0, 0, 0.35);
  border-radius: 14px;
  padding: 14px 16px;
  font-size: 20px;
  font-style: italic;
  font-weight: 500;
  color: var(--color-accent);
  text-align: center;
  line-height: 1.4;
  display: none;
  animation: banterFadeIn 0.4s ease-out;
  border: 1px solid rgba(255, 255, 255, 0.08);
}

#ai-commentary.visible {
  display: block;
}

@keyframes banterFadeIn {
  from { opacity: 0; transform: translateY(-8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ---- Triad Discard Animation ---- */
.triad-completing {
  background: rgba(34, 197, 94, 0.25) !important;
  border-color: var(--color-success) !important;
  box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
}

.triad-card-discarding {
  transition: opacity 0.3s ease-out, transform 0.3s ease-out;
  opacity: 1;
}

.triad-card-discarding.card-gone {
  opacity: 0;
  transform: translateX(40px) scale(0.7) rotate(5deg);
}

/* Scorecard round column â€” narrow */
.sc-round-col {
  width: 28px;
}

/* Scorecard actions â€” stacked vertically */
.scorecard-actions {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-top: 12px;
}

.scorecard-action-btn {
  width: 100%;
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.12);
  font-size: 11px;
  padding: 8px 12px;
}

.scorecard-action-btn:hover:not(:disabled) {
  background: rgba(255, 255, 255, 0.12);
}

/* Scorecard notes */
#scorecard-notes {
  max-height: 120px;
  overflow-y: auto;
  margin-top: 10px;
}

#scorecard-notes:empty {
  display: none;
}

.scorecard-note {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.6);
  padding: 4px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  line-height: 1.4;
}

.scorecard-note-time {
  color: rgba(255, 255, 255, 0.3);
  font-size: 9px;
  margin-right: 4px;
}

/* Scorecard version at bottom */
.scorecard-version {
  text-align: center;
  font-size: 9px;
  color: rgba(255, 255, 255, 0.15);
  margin-top: 10px;
  font-family: 'Courier New', monospace;
  letter-spacing: 0.5px;
}

/* ---- Start Game Button â€” big, satisfying, inviting ---- */
#btn-start-game {
  display: block;
  width: 260px;
  margin: 0 auto;
  padding: 16px 32px;
  font-size: 20px;
  font-weight: 700;
  letter-spacing: 1px;
  background: linear-gradient(135deg, #22c55e, #16a34a);
  border: 2px solid #15803d;
  border-radius: 14px;
  color: white;
  text-shadow: 0 1px 2px rgba(0,0,0,0.2);
  box-shadow: 0 4px 16px rgba(34, 197, 94, 0.3), 0 2px 4px rgba(0,0,0,0.2);
  transition: all 0.15s ease;
  cursor: pointer;
}

#btn-start-game:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(34, 197, 94, 0.4), 0 4px 8px rgba(0,0,0,0.2);
  background: linear-gradient(135deg, #16a34a, #15803d);
}

#btn-start-game:active {
  transform: translateY(1px);
  box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
}

/* Gentle breathing glow â€” the button feels alive */
@keyframes start-glow {
  0%, 100% { box-shadow: 0 4px 16px rgba(34, 197, 94, 0.3), 0 2px 4px rgba(0,0,0,0.2); }
  50% { box-shadow: 0 4px 24px rgba(34, 197, 94, 0.5), 0 2px 4px rgba(0,0,0,0.2); }
}

#btn-start-game {
  animation: start-glow 2.5s ease-in-out infinite;
}

#btn-start-game:hover {
  animation: none;
}

/* ---- "How to Play" link on name screen ---- */
.help-link {
  display: block;
  margin: 12px auto 0;
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.5);
  font-family: var(--font-body);
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  text-decoration: underline;
  text-underline-offset: 3px;
  transition: color 0.2s ease;
}

.help-link:hover {
  color: rgba(255, 255, 255, 0.8);
}

/* ---- Help "?" button (always visible during game) ---- */
#help-toggle {
  display: none;
  position: fixed;
  top: calc(env(safe-area-inset-top, 8px) + 8px);
  left: 16px;
  z-index: 190;
  width: 32px;
  height: 32px;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  color: rgba(255, 255, 255, 0.7);
  font-family: var(--font-body);
  font-size: 16px;
  font-weight: 700;
  border-radius: 50%;
  cursor: pointer;
  line-height: 1;
  padding: 0;
  transition: all 0.15s ease;
}

#help-toggle:hover {
  background: rgba(0, 0, 0, 0.7);
  color: white;
}

/* Show help button when game is active */
#page-layout:not(.hidden) ~ #help-modal,
body:has(#page-layout:not(.hidden)) #help-toggle {
  display: flex;
}

/* Fallback: JS will toggle visibility */
#help-toggle.visible {
  display: flex;
  justify-content: center;
  align-items: center;
}

/* ---- Help Modal ---- */
#help-modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 200;
  padding: 16px;
}

.help-modal-content {
  background: linear-gradient(145deg, #0f2a1a, #1a3f2a);
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  max-width: 560px;
  width: 100%;
  height: min(85vh, 600px);
  display: flex;
  flex-direction: column;
  box-shadow: 0 24px 64px rgba(0,0,0,0.5);
  position: relative;
  overflow: hidden;
}

.help-modal-content > h2 {
  font-family: var(--font-display);
  font-size: 28px;
  color: var(--color-accent);
  letter-spacing: 2px;
  text-align: center;
  padding: 24px 24px 0;
  margin: 0;
  flex-shrink: 0;
}

.help-close {
  position: absolute;
  top: 16px;
  right: 16px;
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.5);
  font-size: 28px;
  cursor: pointer;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.15s ease;
  z-index: 1;
}

.help-close:hover {
  background: rgba(255, 255, 255, 0.1);
  color: white;
}

/* Tab navigation */
.help-tabs {
  display: flex;
  gap: 2px;
  padding: 16px 24px 0;
  flex-shrink: 0;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.help-tab {
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-bottom: none;
  color: rgba(255, 255, 255, 0.5);
  font-family: var(--font-body);
  font-size: 13px;
  font-weight: 600;
  padding: 8px 14px;
  border-radius: 8px 8px 0 0;
  cursor: pointer;
  transition: all 0.15s ease;
  white-space: nowrap;
}

.help-tab:hover {
  color: rgba(255, 255, 255, 0.8);
  background: rgba(255, 255, 255, 0.1);
}

.help-tab.active {
  background: rgba(255, 255, 255, 0.12);
  color: var(--color-accent);
  border-color: rgba(255, 255, 255, 0.15);
}

/* Tab panels */
.help-panel {
  display: none;
  padding: 20px 24px 24px;
  overflow-y: auto;
  flex: 1;
  min-height: 0;
}

.help-panel.active {
  display: block;
}

.help-panel h3 {
  font-family: var(--font-display);
  font-size: 20px;
  color: var(--color-accent);
  letter-spacing: 1px;
  margin: 16px 0 8px;
}

.help-panel h3:first-child {
  margin-top: 0;
}

.help-panel p {
  font-size: 14px;
  line-height: 1.7;
  color: rgba(255, 255, 255, 0.8);
  margin-bottom: 10px;
}

.help-panel ul,
.help-panel ol {
  font-size: 14px;
  line-height: 1.7;
  color: rgba(255, 255, 255, 0.8);
  margin: 0 0 12px 20px;
}

.help-panel li {
  margin-bottom: 4px;
}

.help-panel ul ul {
  margin-top: 4px;
  margin-bottom: 4px;
}

.help-panel strong {
  color: rgba(255, 255, 255, 0.95);
}

.help-panel em {
  color: var(--color-accent);
  font-style: normal;
  font-weight: 600;
}

/* Card type badges in Cards tab */
.help-card-type {
  display: flex;
  gap: 14px;
  align-items: flex-start;
  padding: 12px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  font-size: 14px;
  line-height: 1.6;
  color: rgba(255, 255, 255, 0.8);
}

.help-card-type:last-child {
  border-bottom: none;
}

.help-card-badge {
  width: 42px;
  height: 56px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-display);
  font-size: 20px;
  flex-shrink: 0;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}

.help-badge-fixed {
  background: linear-gradient(180deg, #fff, #f8f9fa);
  color: var(--color-fixed);
  border: 2px solid #d1d5db;
}

.help-badge-power {
  background: linear-gradient(145deg, #fbbf24, #f59e0b);
  color: #1c1917;
  border: 2px solid #d97706;
}

.help-badge-kapow {
  background: radial-gradient(circle at 40% 40%, #fff 20%, #fef3c7 60%, #fde68a 100%);
  color: var(--color-danger);
  border: 2px solid var(--color-danger);
  font-size: 14px;
  font-weight: 900;
  position: relative;
  overflow: hidden;
}

.help-badge-kapow::before {
  content: '';
  position: absolute;
  width: 200%;
  height: 200%;
  top: -50%;
  left: -50%;
  background: conic-gradient(
    from 0deg,
    rgba(239, 68, 68, 0.3) 0deg 60deg,
    rgba(249, 115, 22, 0.3) 60deg 120deg,
    rgba(234, 179, 8, 0.3) 120deg 180deg,
    rgba(34, 197, 94, 0.3) 180deg 240deg,
    rgba(59, 130, 246, 0.3) 240deg 300deg,
    rgba(139, 92, 246, 0.3) 300deg 360deg
  );
  animation: kapow-badge-spin 6s linear infinite;
  border-radius: 50%;
}

@keyframes kapow-badge-spin {
  to { transform: rotate(360deg); }
}

/* Video link */
.help-video {
  margin-top: 16px;
  padding: 12px 16px;
  background: rgba(255, 255, 255, 0.06);
  border-radius: 10px;
  border: 1px solid rgba(255, 255, 255, 0.08);
  text-align: center;
}

.help-video a {
  color: var(--color-accent);
  text-decoration: none;
  font-weight: 700;
  font-size: 14px;
}

.help-video a:hover {
  text-decoration: underline;
}

/* Mobile adjustments for help modal */
@media (max-width: 768px) {
  .help-modal-content {
    max-height: 90vh;
    border-radius: 16px;
  }

  .help-modal-content > h2 {
    font-size: 24px;
    padding: 20px 20px 0;
  }

  .help-tabs {
    padding: 12px 16px 0;
  }

  .help-tab {
    font-size: 12px;
    padding: 6px 10px;
  }

  .help-panel {
    padding: 16px;
  }

  .help-panel h3 {
    font-size: 18px;
  }

  .help-panel p,
  .help-panel ul,
  .help-panel ol {
    font-size: 13px;
  }

  .help-card-badge {
    width: 36px;
    height: 48px;
    font-size: 16px;
  }
}

/* ========================================
   REVISION FOOTER
   ======================================== */
#revision-footer {
  position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 11px;
  color: rgba(255, 255, 255, 0.5);
  font-weight: 500;
  letter-spacing: 0.5px;
  pointer-events: auto;
  display: none; /* hidden on mobile â€” version shown in top bar instead */
}

@media (min-width: 769px) {
  #revision-footer {
    display: block;
  }
}

/* ========================================
   BUY FUNNEL â€” CTAs & Modals
   ======================================== */

.footer-buy {
  color: var(--color-accent);
  text-decoration: none;
  font-weight: 600;
  font-size: 11px;
  pointer-events: auto;
  opacity: 0.7;
  transition: opacity 0.2s ease;
}

.footer-buy:hover {
  opacity: 1;
  text-decoration: underline;
}

/* Name screen CTA tiers */
#name-screen-cta {
  margin-top: 16px;
}

.kapow-cta-quiet {
  margin-top: 8px;
}

.kapow-buy-link-quiet {
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.4);
  font-family: var(--font-body);
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  padding: 0;
  transition: color 0.2s ease;
}

.kapow-buy-link-quiet:hover {
  color: rgba(255, 255, 255, 0.7);
}

.kapow-cta-subtle {
  font-size: 13px;
  color: rgba(255, 255, 255, 0.6);
  margin-top: 8px;
}

.kapow-buy-link {
  background: none;
  border: none;
  color: var(--color-accent);
  font-family: var(--font-body);
  font-size: inherit;
  font-weight: 600;
  cursor: pointer;
  padding: 0;
  text-decoration: underline;
  text-underline-offset: 3px;
  transition: opacity 0.2s ease;
}

.kapow-buy-link:hover {
  opacity: 0.8;
}

/* Banner CTA (3+ games) */
.kapow-cta-banner {
  background: rgba(251, 191, 36, 0.1);
  border: 1px solid rgba(251, 191, 36, 0.25);
  border-radius: 12px;
  padding: 14px 18px;
  margin-top: 12px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  font-size: 13px;
  color: rgba(255, 255, 255, 0.8);
}

.kapow-buy-btn {
  display: inline-block;
  padding: 10px 24px;
  font-family: var(--font-body);
  font-size: 14px;
  font-weight: 700;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  background: var(--color-accent);
  color: #1c1917;
  transition: all 0.15s ease;
  text-decoration: none;
  text-align: center;
}

.kapow-buy-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
}

/* Warm variant (game over) */
.kapow-buy-btn-warm {
  background: linear-gradient(135deg, var(--color-accent), #f59e0b);
}

/* Game over CTA */
.kapow-cta-gameover {
  margin-top: 20px;
  padding-top: 16px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  text-align: center;
}

.kapow-cta-gameover p {
  font-size: 15px;
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 10px;
}

/* Round end CTA */
.kapow-cta-round {
  margin-top: 12px;
  text-align: center;
  font-size: 12px;
  opacity: 0.6;
}

/* Interstitial overlay */
#kapow-interstitial {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 210;
}

.interstitial-content {
  background: linear-gradient(145deg, #0f2a1a, #1a3f2a);
  padding: 40px;
  border-radius: 20px;
  text-align: center;
  max-width: 420px;
  width: 90%;
  border: 2px solid var(--color-accent);
  box-shadow: 0 24px 64px rgba(0,0,0,0.5);
}

.interstitial-content h2 {
  font-family: var(--font-display);
  font-size: 36px;
  color: var(--color-accent);
  margin-bottom: 12px;
  letter-spacing: 4px;
}

.interstitial-text {
  font-size: 16px;
  color: rgba(255, 255, 255, 0.85);
  line-height: 1.6;
  margin-bottom: 24px;
}

.interstitial-buttons {
  display: flex;
  gap: 12px;
  justify-content: center;
}

.interstitial-show {
  background: var(--color-accent) !important;
  color: #1c1917 !important;
  font-size: 15px !important;
  padding: 10px 24px !important;
}

.interstitial-later {
  background: rgba(255, 255, 255, 0.08) !important;
  color: rgba(255, 255, 255, 0.6) !important;
  border: 1px solid rgba(255, 255, 255, 0.15) !important;
  font-size: 14px !important;
  padding: 10px 20px !important;
}

.interstitial-later:hover {
  background: rgba(255, 255, 255, 0.12) !important;
  color: rgba(255, 255, 255, 0.8) !important;
}

/* Email capture modal */
#kapow-buy-modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 220;
}

.buy-modal-content {
  background: linear-gradient(145deg, #0f2a1a, #1a3f2a);
  padding: 36px;
  border-radius: 20px;
  text-align: center;
  max-width: 420px;
  width: 90%;
  border: 2px solid var(--color-accent);
  box-shadow: 0 24px 64px rgba(0,0,0,0.5);
  position: relative;
}

.buy-modal-content h2 {
  font-family: var(--font-display);
  font-size: 28px;
  color: var(--color-accent);
  margin-bottom: 10px;
  letter-spacing: 2px;
}

.buy-modal-content p {
  font-size: 14px;
  color: rgba(255, 255, 255, 0.75);
  line-height: 1.6;
  margin-bottom: 16px;
}

.buy-modal-close {
  position: absolute;
  top: 12px;
  right: 16px;
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.4);
  font-size: 24px;
  cursor: pointer;
  padding: 0;
  line-height: 1;
  transition: color 0.15s ease;
}

.buy-modal-close:hover {
  color: rgba(255, 255, 255, 0.8);
}

.buy-modal-input {
  display: block;
  width: 100%;
  padding: 12px 16px;
  font-family: var(--font-body);
  font-size: 15px;
  border: 2px solid rgba(255, 255, 255, 0.2);
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.08);
  color: white;
  text-align: center;
  outline: none;
  margin-bottom: 12px;
  transition: all 0.2s ease;
}

.buy-modal-input::placeholder {
  color: rgba(255, 255, 255, 0.3);
}

.buy-modal-input:focus {
  border-color: var(--color-accent);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 0 3px var(--color-accent-glow);
}

#kapow-email-thanks p {
  color: var(--color-success);
  font-weight: 600;
  font-size: 15px;
}
